# Bloodhound configuration for Redis-Rust testing
# Run with: bloodhound test --config bloodhound.yaml

compose: docker-compose.yml

# Workload configuration
workload:
  driver: redis
  config:
    master: "redis://redis:6379"
    operations_per_second: 200
    duration_seconds: 60
    operations:
      - type: SET
        weight: 4
        key_pattern: "key:{seq}"
        value_size: 100
      - type: GET
        weight: 5
        key_pattern: "key:{random}"
      - type: INCR
        weight: 1
        key_pattern: "counter:{seq:1-100}"

# Properties to verify
properties:
  - name: server-available
    kind: safety
    description: "Redis server should always respond to PING"
    check:
      type: redis
      endpoint: "redis://redis:6379"
      command: PING
      expect: PONG

  - name: linearizability
    kind: safety
    description: "GET should return the last SET value"
    check:
      type: linearizability
      operations: [SET, GET]

  - name: counter-monotonic
    kind: safety
    description: "INCR should always increase counter value"
    check:
      type: custom
      script: |
        # Verify counters are non-negative integers
        redis-cli -h redis KEYS 'counter:*' | while read key; do
          val=$(redis-cli -h redis GET "$key")
          [ "$val" -ge 0 ] || exit 1
        done

  - name: recovery-after-restart
    kind: liveness
    description: "Server should recover and respond within 10 seconds"
    timeout_ms: 10000
    check:
      type: redis
      endpoint: "redis://redis:6379"
      command: PING
      expect: PONG

# Fault injection configuration
faults:
  enabled: true
  mode: moderate
  network:
    enabled: true
    drop_rate: 0.01
    delay_ms: 20
    delay_jitter_ms: 10
  process:
    enabled: true
    pause_probability: 0.001
    pause_duration_ms: [100, 500]
  disk:
    enabled: false  # memory-only mode

# Exploration settings
exploration:
  strategy: coverage-guided
  max_depth: 200
  max_states: 5000
  parallel_workers: 2
  seed: 42

# Debug settings
debug:
  trace_file: "./traces/redis-rust.trace"
  snapshot_interval: 50
